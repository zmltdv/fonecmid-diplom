#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда   
	
	#Область ОбработчикиСобытийМодуляОбъекта
	
	Процедура ОбработкаПроведения(Отказ, Режим)     
		
		Если НЕ ЗначениеЗаполнено(Выплаты) Тогда
			
			ОбщегоНазначения.СообщитьПользователю("Не заполнено ни одной строчки"); 
			Отказ = Истина; 
			
		КонецЕсли;
		
		// регистр ВКМ_ВзаиморасчетыССотрудниками Приход
		Движения.ВКМ_ВзаиморасчетыССотрудниками.Записывать = Истина;
		Для Каждого ТекСтрокаВыплаты Из Выплаты Цикл
			Движение = Движения.ВКМ_ВзаиморасчетыССотрудниками.Добавить();
			Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
			Движение.Период = Дата;
			Движение.Сотрудник = ТекСтрокаВыплаты.Сотрудник;
			Движение.Подразделение = ТекСтрокаВыплаты.Подразделение;
			Движение.Сумма = ТекСтрокаВыплаты.Сумма;
		КонецЦикла;
		
	КонецПроцедуры  
	
	#КонецОбласти
	
	#Область СлужебныеПроцедурыФункции
	
	Процедура ЗаполнитьЗП() Экспорт
		
		Выплаты.Очистить();
		 
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ВКМ_ВзаиморасчетыССотрудникамиОстатки.Сотрудник КАК Сотрудник,
		|	ВКМ_ВзаиморасчетыССотрудникамиОстатки.Подразделение КАК Подразделение,
		|	ВКМ_ВзаиморасчетыССотрудникамиОстатки.СуммаОстаток КАК СуммаОстаток
		|ИЗ
		|	РегистрНакопления.ВКМ_ВзаиморасчетыССотрудниками.Остатки(&Дата, ) КАК ВКМ_ВзаиморасчетыССотрудникамиОстатки
		|ГДЕ
		|	ВКМ_ВзаиморасчетыССотрудникамиОстатки.СуммаОстаток > 0"; // Фильтр положительных остатков
		
		Запрос.УстановитьПараметр("Дата", Дата); 
		
		РезультатЗапроса = Запрос.Выполнить();    
		
		Если РезультатЗапроса.Пустой() Тогда
			
			ОбщегоНазначения.СообщитьПользователю("Остатков по выплатам нет!"); 
			Возврат; 
		КонецЕсли;
		
		Выборка = РезультатЗапроса.Выбрать(); 
		
		Пока Выборка.Следующий() Цикл
			
			Если Выборка.СуммаОстаток > 0 Тогда
				Строка = Выплаты.Добавить();        
				Строка.Сотрудник = Выборка.Сотрудник; 
				Строка.Подразделение = Выборка.Подразделение; 
				Строка.Сумма = Выборка.СуммаОстаток; 
			КонецЕсли;
			
		КонецЦикла;
		
	КонецПроцедуры   
	
	#КонецОбласти
	
#КонецЕсли


